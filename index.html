<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./style.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body>
    <div class="main">
      <form class="main__form form">
        <div class="form__rate">
          <label for="comment">Выберите рейтинг:</label>
          <input type="text" class="rate" />
        </div>
        <div class="form__r">
          <label for="comment">Выберите раздел:</label>
          <input type="text" class="r" />
        </div>
        <div class="form__name">
          <label for="comment">Введите название:</label>
          <input type="text" class="name" />
        </div>
        <div class="form__link">
          <label for="comment">Введите ссылку:</label>
          <textarea type="text" class="link"></textarea>
        </div>
        <button class="button" type="button" onclick="sendData()">
          Сохранить
        </button>
      </form>
      <div class="main__body body">
        <div class="body__cards">
          <h1>Верстка</h1>
        </div>
        <div class="body__cards2" id="cards2"><h1>Frontend</h1></div>
        <div class="body__cards3" id="cards3"><h1>WEB</h1></div>
      </div>
      <div class="other" id="other">
        <h1>Другое</h1>
      </div>
    </div>

    <template class="tpl">
      <div class="work">
        <h2 class="work__rate"></h2>
        <a href="" class="work__link"> </a>
        <img src="#" alt="#" class="work__img" />
      </div>
    </template>
  </body>

  <script>
    const cards = document.querySelector(".body__cards");
    const block = document.querySelector(".tpl");
    const dataLink = document.querySelector(".link");
    const dataName = document.querySelector(".name");
    const dataR = document.querySelector(".r");
    const dataRate = document.querySelector(".rate");
    const dataImg = document.querySelector(".work__img");

    const clickf = function (ee) {
      location.href = ee;
    };

    const urlGet =
      "https://script.google.com/macros/s/AKfycbzRWm10SJkDRMbOmSYFoIRBHtOdjkDtYG9MAaAihNLjt9SJ_jsuvN91c1Xsd4UWo1CReg/exec";
    const urlSet = `https://script.google.com/macros/s/AKfycbzLl0darI2L26DePSLLgFgR8Gos0f3Bzlrst06MhXiWV9p9QRVE-juGD6WxtOgB4oWT_g/exec?GoogleSheetId=12sjyoza_2v9wetwhltX4bSlJj9WY6enltMqlrtpW9VM`;

    fetch(urlGet)
      .then((res) => res.text())
      .then((data) => {
        let res = JSON.parse(data),
          result = res["result"];

        for (let i = 0; i < result.length; i++) {
          let obj = res["result"][i];
          const newWork = block.content.cloneNode(true);
          console.log(newWork);
          const nimage = newWork.querySelector(".work__img");
          newWork.querySelector(".work__link").textContent = obj[1];
          newWork.querySelector(".work__link").href = obj[2];
          newWork.querySelector(".work__rate").textContent = obj[3];
          newWork.querySelector(".work__img").src =
            "https://thumbnail." + obj[2].substring(8, 30) + ".png";
          nimage.addEventListener("click", (e) => clickf(obj[2]));

          const id = obj[0];
          switch (id) {
            case 1:
              cards.append(newWork);

              break;
            case 2:
              cards2.append(newWork);
              break;
            case 3:
              cards3.append(newWork);
              break;
            case 0:
              other.append(newWork);
              break;
          }
          cards.append(newWork);
        }
      })
      .catch((err) => console.log(err));

    function sendData() {
      const http = new XMLHttpRequest();
      const r = "&id=" + +dataR.value;
      const name = "&name=" + dataName.value;
      const link = "&link=" + dataLink.value;
      const rate = "&rate=" + dataRate.value;

      console.log(urlSet + r + name + link + rate);
      http.open("GET", urlSet + r + name + link + rate);
      http.onload = function () {
        console.log(http.responseText);
      };
      http.send();
      dataName.value = "";
      dataR.value = "";
      dataRate.value = "";
      dataLink.value = "";
    }
  </script>
</html>
